<!doctype html>
<html lang="en">

<head>
   <meta charset="utf-8" />
   <link rel="icon" type="image/png" href="assets/img/logo.png">

   <title>Baguio Teacher's Camp</title>

   <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
   <meta name="viewport" content="width=device-width" />
   <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
   <link href="assets/css/animate.min.css" rel="stylesheet" />
   <link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet" />
   <link href='assets/fonts/Roboto.ttf' rel='stylesheet' type='text/css'>
   <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
   <script src="facility_reservation.js"></script>
    

<style type="text/css">

/* Style the tab */
div.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
div.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
}

/* Change background color of buttons on hover */
div.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
div.tab button.active {
    background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
}
</style>

</head>

<body>

  <div class="wrapper">
      <div class="sidebar" data-color="green" ; data-image="assets/img/sidebar-5.jpg">

         <div class="sidebar-wrapper">
            <div class="logo">
               <a href="dashboard.html" class="simple-text">
                    Baguio Teacher's Camp
                </a>
            </div>


<ul class="nav">
               <li>
                  <a href="/home">
                     <i class="pe-7s-home"></i>
                     <p>Dashboard</p>
                  </a>
               </li>
               <li>
                  <a href="/newreservation">
                     <i class="pe-7s-note"></i>
                     <p>Create Reservation</p>
                  </a>
               </li>
               <li>
                  <a href="/reservations">
                     <i class="pe-7s-photo-gallery"></i>
                     <p>Reservations</p>
                  </a>
               </li>
               <li class="active">
                  <a href="/newregistration">
                     <i class="pe-7s-pen"></i>
                     <p>Create Registration</p>
                  </a>
               </li>
               <li>
                  <a href="/guests">
                     <i class="pe-7s-albums"></i>
                     <p>Registrations</p>
                  </a>
               </li>
               <li>
                  <a href="/checkavailable">
                     <i class="pe-7s-check"></i>
                     <p>Check Facilities</p>
                  </a>
               </li>
               <li>
                  <a href="/tables_facilities">
                     <i class="pe-7s-config"></i>
                     <p>Facilities</p>
                  </a>
               </li>
               <li>
                  <a href="/home?action=logout">
                     <i class="pe-7s-power"></i>
                     <p>Log Out</p>
                  </a>
               </li>
            </ul>


         </div>
      </div>
      <div class="main-panel">
         <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
               <div class="navbar-header">
                  <a class="navbar-brand" href="#">Create Registration</a>
               </div>
               <div class="collapse navbar-collapse">
                  <ul class="nav navbar-nav navbar-left">

                     <li class="separator hidden-lg hidden-md"></li>
                  </ul>
               </div>
            </div>
         </nav>


         <div class="content">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-md-12">


                  <div class="tab">
                    <button id="regform" class="tablinks">Details</button>
                    <button id="facform" class="tablinks">Facilities</button>
                    <button id="sumform" class="tablinks">Summary</button>
                  </div>




                     <div class="card tabcontent" id="registerForm">

                        <div class="header">
                           <h4 class="title">Registration Form</h4>
                        </div>

                        <div class="content">
                          <div class="row">
                            <div class="col-md-12" id="notif"> </div>
                          </div>
                        </div>

                        <div class="content">
                           <form onsubmit="return false;" name='newReservation'>



                              <div class="row">
                                 <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='name'>Name / Organization</label>
                                       <input id="form_name" name='name' type="text" class="form-control" placeholder="" required >
                                    </div>
                                 </div>

                                 <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='name'>ID Number</label>
                                       <input id="form_name" name='name' type="text" class="form-control" placeholder="" required >
                                    </div>
                                 </div>

                                 <div class="col-md-4">
                                    <label for="form_affiliation">Affiliation</label>
                                    <select id="form_affiliation" name='form_affiliation'class="form-control">
                                       <option value="def">Choose an Affiliation</option>
                                       <option value="deped">DepEd</option>
                                       <option value="govt">Government</option>
                                       <option value="private">Private</option>
                                       <option value="vip">VIP</option>
                                    </select>
                                 </div>
                              </div>



                              <div class="row">                                
                                 <div class="col-md-8">
                                    <div class="form-group">
                                       <label for='cp'>Address</label>
                                       <input id="address" name='address' type="text" class="form-control" placeholder="" required>
                                    </div>
                                 </div>
								   <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='birthdate'>Birthdate:</label>
                                        <input id="birthdate" name="birthdate" type="date" placeholder="" class="form-control" required="">
                                    </div>
                                 </div>
                                </div>


                               <div class="row">
                                 <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='form_contact1'>Res. Tel No.</label>
                                       <input id="form_contact1" name='form_contact1' type="tel" class="form-control" placeholder="" required>
                                    </div>
                                 </div>
                                 
                                 <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='form_contact2'>Office Tel. No</label>
                                       <input id="form_contact2" name='form_contact2' type="tel" class="form-control" placeholder="" required>
                                    </div>
                                 </div>
                                 
                                
                                 <div class="col-md-4">
                                    <div class="form-group">
                                       <label for='email'>Email Address</label>
                                       <input id="email" name='email' type="email" class="form-control" placeholder="" required>
                                    </div>
                                 </div>
                              </div>


                              <div class="row">
                                 <div class="col-md-4">
                                    <label for="category">Type</label>
                                    <select onchange="checkNum();" id="form_gtype" name='category'class="form-control">
                                       <option value="def">Choose a Type</option>
                                       <option value="individual">Individual</option>
                                       <option value="group">Group</option>
                                    </select>
                                 </div>

                                 <div class="col-md-2">
                                    <div class="form-group">
                                       <label for='adults'>Adults</label>
                                       <input onblur="checkval(this);total();"  value="0" id="adults" name='adults' type="number" min="1" max="1500" class="form-control" placeholder="" disabled>
                                    </div>
                                 </div>

                                 <div class="col-md-2">
                                    <div class="form-group">
                                       <label for='seniors'>Seniors</label>
                                       <input onblur="checkval(this);total(); "  value="0" id="seniors" name='seniors' type="number" min="1" max="1500" class="form-control" placeholder="" disabled>
                                    </div>
                                 </div>

                                 <div class="col-md-2">
                                    <div class="form-group">
                                       <label for='children'>Children</label>
                                       <input onblur="checkval(this);total(); " value="0" id="children" name='children' type="number" min="1" max="1500" class="form-control" placeholder="" disabled>
                                    </div>
                                 </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                       <label for='form_number'>Total Participants</label>
                                       <input id="form_number"  value="0" name='form_number' type="number" min="1" max="1500" class="form-control" placeholder="" disabled>
                                    </div>
                                 </div>

                              </div>
							  <div class="row">
                              <div class="col-md-6">
                                    <div class="form-group">
                                       <label for ='activity'>Activity / Purpose</label>
                                       <input id="form_activity" name='activity' type="text" class="form-control" required>
                                    </div>
                                 </div>
                                 <div class="col-md-2">
                                    <label for='lodging'>Lodging:</label>
                                    <select id="lodging" name='lodging'class="form-control">
                                       <option value="def">Choose a Type</option>
                                       <option value="in">Live-in</option>
                                       <option value="out">Live-out</option>
                                    </select>
                                 </div>
                                 <div class="col-md-2">
                                    <label for='arrival'>Check-In:</label>
                                    <input id="form_arrival" name="arrival" type="date" placeholder="" class="form-control" required="">
                                 </div>
                                 <div class="col-md-2">
                                    <label for='departure'>Check-out:</label>
                                    <input id="form_departure" name="departure" type="date" placeholder="" class="form-control" required="">
                                 </div>
                              </div>
                              <div class="row">
                              <div class="col-md-6">
                                    <div class="form-group">
                                       <label for ='contactPerson'>Emergency Contact Person:</label>
                                       <input id="contactPerson" name='contactPerson' type="text" class="form-control" placeholder="Mame" required>
                                    </div>
                                 </div>
								  <div class="col-md-6">
                                    <div class="form-group">
                                       <label for ='contactPerson'>Emergency Contact Number:</label>
                                       <input id="contactPerson" name='contactPerson' type="text" class="form-control" placeholder="Contact Number" required>
                                    </div>
                                 </div>
                              <div class="row">
                                 <div class="col-md-12">
                                    <div class="form-group">
                                       <label>Additional Notes</label>
                                       <textarea id="form_remarks" rows="2" class="form-control" placeholder="Type additional remarks here."></textarea>
                                    </div>
                                 </div>
                              </div>

                            <div class="row">
                              <div class="col-md-2">
                                    <a class="btn btn-danger btn-fill pull-left" onclick="cancelReservation();">Cancel</a>
                                 </div>
                                 <div class="col-md-8">

                                 </div>
                                 <div class="col-md-2">
                                    <a class="btn btn-info btn-fill pull-right" onclick="checkForm(event);">Next</a>
                                 </div>
                              </div>




                              <div class="clearfix"></div>
                           </form>
                            </div>

                     
                     </div>


                        <div class="card tabcontent" id="facilities">



                        </div>


                        <div class="card tabcontent" id="summary">

<div class="card">
                        <div class="header">
                           <h4 class="title">Reservation Details</h4>
                        </div>
                        <div class="content">
                                          <table class="table table-user-information">
                                          <thead>
                                             <tr>
                                                <th width="30%">Detail</th>
                                                <th>Data</th>
                                             </tr>
                                          </thead>
                                             <tbody>
                                                <tr>
                                                   <td>Name:</td>
                                                   <td id="sum_name"></td>
                                                </tr>
                                                <tr>
                                                   <td>Contact No:</td>
                                                   <td id="sum_c1"></td>
                                                </tr>
                                                <tr>
                                                   <td>Alt Contact No:</td>
                                                   <td id="sum_c2"></td>
                                                </tr>
                                                <tr>
                                                   <td>Activity/Purpose</td>
                                                   <td id="sum_act"></td>
                                                </tr>
                                                   <tr>
                                                      <td>Affiliation</td>
                                                      <td id="sum_affi"></td>
                                                   </tr>

                                                   <tr>
                                                      <td>Guest Type</td>
                                                      <td id="sum_gtype"></td>
                                                   </tr>
                                                   <tr>
                                                      <td>Participants</td>
                                                      <td id="sum_no"></td>
                                                   </tr>
                                                   
                                                   <tr>
                                                      <td>Arrival Date</td>
                                                      <td id="sum_arriv"></td>
                                                   </tr>
                                                    <tr>
                                                      <td>Departure Date</td>
                                                      <td id="sum_dep"></td>
                                                   </tr>
                                                    <tr>
                                                      <td>Remarks</td>
                                                      <td id="sum_remarks"></td>
                                                   </tr>
                                                    <tr>
                                                      <td>Requested Facilities</td>
                                                      <td id="sum_facs"></td>
                                                   </tr>
                            
                                             </tbody>
                                          </table>
                     
                                </div>
                              </div>
                            <div class="row">
                              <div class="col-md-1">
                                    <a class="btn btn-danger btn-fill pull-left" onclick="cancelReservation();">Cancel</a>
                                 </div>
                                 <div class="col-md-9">
                                    <a class="btn btn-info btn-fill pull-left" onclick="openTab('facform', 'facilities');">Back</a>
                                 </div>
                                 <div class="col-md-2">
                                    <a class="btn btn-success btn-fill pull-right" onclick="saveReservation();">Save</a>
                                 </div>
                              </div>

                        </div>


                     </div>
                  </div>
               </div>
            </div>
         </div>

      </div>
   </div>


</body>
<!--   Core JS Files   -->
<script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
<!--  Checkbox, Radio & Switch Plugins -->
<script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>
<!--  Charts Plugin -->
<script src="assets/js/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="assets/js/bootstrap-notify.js"></script>
<!-- Light Bootstrap Table Core javascript and methods-->
<script src="assets/js/light-bootstrap-dashboard.js"></script>
<script type="text/javascript">



function saveReservation() {
    details.facs = fac;
    var data2x = "/savereservation?details="+JSON.stringify(details);
    $.get(data2x, {}, function(data){
      if(data == "done") {
         window.location.href="/pages?id=5";
      } else {
        window.location.href="/pages?id=7";
      }
    });
    
}

function checkval(x) {
  if(x.value == "" || x.value < 0) {
      x.value = 0;
      return false;
  }
}

function cancelReservation() {
   var conf = confirm("Are you sure you want to cancel?");
   if(conf) {
      window.location.href = "/home";
   }
}

var currentType = "";
function checkNum() {
   var gtype = $("#form_gtype");
   var val = gtype.val();

   if(val == "individual") {
      $("#form_number").attr("disabled", true).val("0");
      $("#adults").removeAttr("disabled");
      $("#seniors").removeAttr("disabled");
      $("#children").removeAttr("disabled");
      currentType = "individual";
      $("#notif").html(``);
   } else if(val == "group") {
      $("#form_number").removeAttr("disabled").val("0");;
      $("#adults").attr("disabled", true).val("0");
      $("#seniors").attr("disabled", true).val("0");
      $("#children").attr("disabled", true).val("0");
      currentType = "group";
      $("#notif").html(``);
   } else if(val == "def") {
      $("#form_number").attr("disabled", true).val("0");
      $("#adults").attr("disabled", true).val("0");
      $("#seniors").attr("disabled", true).val("0");
      $("#children").attr("disabled", true).val("0");
      currentType = "";
      $("#notif").html(``);
   }
}

function total() {
  var total = $("#form_number");
  var adults = $("#adults");
  var seniors = $("#seniors");
  var children = $("#children");
  if(currentType == "individual") {
     if(parseInt(seniors.val(), 10) > parseInt(adults.val(), 10)) {
        $("#notif").html(`<div class="alert alert-danger">
                            The number of seniors or PWDS cannot be more than total adults!
                      </div>`);
        seniors.val("0");
        seniors.focus();
        return false;
     } else {
       $("#notif").html(``);
     }
     //$("#notif").html(``+(adults.val() + children.val()));

     total.val( parseInt(adults.val(), 10) + parseInt(children.val(), 10) );

  }

}

function loadFacilities(arriv, dep, total, gtype, affi, lodging) {
    $.get("/allreserves?&arrival="+arriv+"&departure="+dep+"&total="+total+"&gtype="+gtype+"&affiliation="+affi+"&lodging="+lodging,{},function(data){
         if(data)  { 
            $("#facilities").html(data); 
         }
    });
}


var details = {
        name:"", 
        cp:"", 
        address: "", 
        c1:"", 
        c2:"", 
        email:"", 
        act:"", 
        gtype:"", 
        no:"", 
        adults:"",
        seniors:"",
        children:"",
        affi:"", 
        lodging:"", 
        arriv:"", 
        dep:"", 
        remarks:""
};

function checkForm(evt) {
   var name = $("#form_name");
   var cp = $("#cp");
   var address = $("#address");
   var c1 = $("#form_contact1");
   var c2 = $("#form_contact2");
   var email = $("#email");
   var act = $("#form_activity");
   var gtype = $("#form_gtype");
   var no = $("#form_number");
   var adults = $("#adults");
   var seniors = $("#seniors");
   var children = $("#children");
   var affi = $("#form_affiliation");
   var lodging = $("#lodging");
   var arriv = $("#form_arrival");
   var dep = $("#form_departure");

   if(name.val().length == 0) {
      alert("Please enter a name.");
      name.focus();
      return false;
   }

   if(affi.val() == "def") {
      alert("Please choose an affiliation.");
      affi.focus();
      return false;
   }

   if(cp.val().length == 0) {
      alert("Please enter a contact person.");
      cp.focus();
      return false;
   }

   if(address.val().length == 0) {
      alert("Please enter an address.");
      address.focus();
      return false;
   }


   if(c1.val().length == 0 && c2.val().length == 0) {
      alert("Please enter a contact number.");
      c1.focus();
      return false;
   }
   if(c1.val().length > 0 && !$.isNumeric(c1.val())) {
      alert("Contact number is not a number!");
      c1.focus();
      return false;
   } else if(c2.val().length > 0 && !$.isNumeric(c2.val())) {
      alert("Alternate contact number is not a number!");
      c2.focus();
      return false;
   }

   if(gtype.val() == "def") {
      alert("Please choose a guest type.");
      gtype.focus();
      return false;
   }

   if(gtype.val() == "group" && no.val() < 2) {
      alert("The number of participants for a group must be more than 1.");
      no.focus();
      return false;
   }

   if(no.val() < 0) {
      alert("Number of participants cannot be negative.");
      no.focus();
      return false;
   }

   if(no.val() == 0) {
      alert("The total number of participants cannot be zero!");
      no.focus();
      return false;
   }


   if(act.val().length == 0) {
      alert("Please enter an activity.");
      act.focus();
      return false;
   }

   if(lodging.val() == "def") {
      alert("Please enter a lodging type.");
      lodging.focus();
      return false;
   }

   if(!arriv.val()) {
      alert("Please choose an arrival date.");
      arriv.focus();
      return false;
   }
   var arrivDate = new Date(arriv.val());
   var currDate = new Date();
   var compArriv = new Date(arrivDate.getYear(), arrivDate.getMonth(), arrivDate.getDate());
   var compCurr = new Date(currDate.getYear(), currDate.getMonth(), currDate.getDate());

   if(compArriv < compCurr) {
      alert("Arrival date cannot be from the past!");
      arriv.focus();
      return false;
   }

   if(!dep.val()) {
      alert("Please choose a departure date.");
      dep.focus();
      return false;
   }

   var arrivDate = new Date(arriv.val());
   var depDate = new Date(dep.val());
   var compArriv = new Date(arrivDate.getYear(), arrivDate.getMonth(), arrivDate.getDate());
   var compDep = new Date(depDate.getYear(), depDate.getMonth(), depDate.getDate());
   if(compDep < compArriv) {
      alert("You cannot depart before arriving!");
      dep.focus();
      return false;
   }

   details.name = name.val();
   details.cp = cp.val();
   details.address = address.val();
   details.c1 = c1.val();
   details.c2 = c2.val();
   details.email = email.val();
   details.gtype = gtype.val();
   details.no = no.val();
   details.adults = adults.val();
   details.seniors = seniors.val();
   details.children = children.val();
   details.affi = affi.val();
   details.act = act.val();
   details.lodging = lodging.val();
   details.arriv = arriv.val();
   details.dep = dep.val();
   details.remarks = $("#form_remarks").val();

   loadFacilities(arriv.val(), dep.val(), no.val(), gtype.val(), affi.val(), lodging.val());
   openTab("facform", "facilities");
}

function showSummary() {
   openTab("sumform", "summary");
   $("#sum_name").html(details.name);
   $("#sum_c1").html(details.c1);
   $("#sum_c2").html(details.c2);
   $("#sum_act").html(details.act);
   $("#sum_gtype").html(details.gtype);
   $("#sum_no").html(details.no);
   $("#sum_affi").html(details.affi);
   $("#sum_arriv").html(details.arriv);
   $("#sum_dep").html(details.dep);
   $("#sum_remarks").html(details.remarks);
   $("#sum_facs").html(fac.names.toString().replace(/,/g, ", "));
}

function goBack() {
   var conf = confirm("Going back will reset the facilities you have added. Continue?");
   if(!conf) {
      return false; // cancel
   }
   console.log(fac);
     openTab("regform", "registerForm");
     fac = {
         halls:[],
         cottages:[],
         guesthouses:[],
         //dorm_rooms:[],
         dormitories:[],
         dining_kitchen:[],
         rentables:[]
      }
     console.log(fac);
}

</script>

<script type="text/javascript">
function openTab(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    document.getElementById(evt).className += " active"
}

openTab("regform", "registerForm");
</script>

</html>